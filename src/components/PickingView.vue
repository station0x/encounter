<template>
    <div class="picking-bg">
        <div class="picking-hud-wrapper">
            <template>
                <svg id="picking-hud" viewBox="0 0 858 513" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <g id="picking board">
                    <g id="outline">
                    <g id="Group 264">
                    <g id="my-hud">
                    <path id="Vector" d="M205.906 482.82L272.851 482.82L291.869 511.36L329.525 511.36L329.525 512.792L291.108 512.792L272.09 484.252L205.906 484.252L205.906 482.82Z" fill="#515151"/>
                    <path id="Vector_2" d="M348.544 488.89L396.09 488.89L396.09 487.7L348.544 487.7L348.544 488.89Z" fill="#515151"/>
                    <path id="Vector_3" d="M89.4177 478.782L82.2858 485.917L79.9085 485.917L87.0404 478.782L89.4177 478.782Z" fill="#FBC115"/>
                    <path id="Vector_4" d="M84.6631 478.782L77.5312 485.917L75.1539 485.917L82.2858 478.782L84.6631 478.782Z" fill="#FBC115" fill-opacity="0.8"/>
                    <path id="Vector_5" d="M79.9084 478.782L72.7765 485.917L70.3992 485.917L77.5311 478.782L79.9084 478.782Z" fill="#FBC115" fill-opacity="0.6"/>
                    <path id="Vector_6" d="M75.1538 478.782L68.0219 485.917L65.6446 485.917L72.7765 478.782L75.1538 478.782Z" fill="#FBC115" fill-opacity="0.4"/>
                    <path id="Vector_7" d="M70.3992 478.782L63.2673 485.917L60.89 485.917L68.0219 478.782L70.3992 478.782Z" fill="#FBC115" fill-opacity="0.1"/>
                    <path id="Vector_8" d="M279.469 457.177L279.735 457.577L258.278 471.88L205.906 471.88L205.906 471.409L258.135 471.409L279.469 457.177Z" fill="#515151"/>
                    <path id="Vector_9" d="M353.456 256.393L2.40826 257.236L2.40824 487.581L86.9832 487.581L96.4924 478.068L277.847 478.068L296.866 506.608L324.3 506.608L324.3 497.509L343.319 478.482L343.319 469.711L344.745 469.649L344.745 479.077L325.726 498.103L325.726 508.035L296.105 508.035L277.087 479.495L97.0867 479.495L87.5775 489.008L0.991609 489.008L0.99163 255.809L181.934 255.809L353.456 256.393Z" fill="#515151"/>
                    <path id="Vector_10" d="M585.894 482.82L652.839 482.82L652.839 484.252L586.654 484.252L567.636 512.792L529.219 512.792L529.219 511.36L566.875 511.36L585.894 482.82Z" fill="#515151"/>
                    <path id="Vector_11" d="M462.654 488.89L510.2 488.89L510.2 487.7L462.654 487.7L462.654 488.89Z" fill="#515151"/>
                    <path id="Vector_12" d="M769.326 478.782L776.458 485.917L778.836 485.917L771.704 478.782L769.326 478.782Z" fill="#FBC115"/>
                    <path id="Vector_13" d="M774.081 478.782L781.213 485.917L783.59 485.917L776.458 478.782L774.081 478.782Z" fill="#FBC115" fill-opacity="0.8"/>
                    <path id="Vector_14" d="M778.836 478.782L785.968 485.917L788.345 485.917L781.213 478.782L778.836 478.782Z" fill="#FBC115" fill-opacity="0.6"/>
                    <path id="Vector_15" d="M783.59 478.782L790.722 485.917L793.1 485.917L785.968 478.782L783.59 478.782Z" fill="#FBC115" fill-opacity="0.4"/>
                    <path id="Vector_16" d="M788.345 478.782L795.477 485.917L797.854 485.917L790.722 478.782L788.345 478.782Z" fill="#FBC115" fill-opacity="0.1"/>
                    <path id="Vector_17" d="M506.058 256.436L856.585 257.278L856.585 487.623L772.136 487.623L762.641 478.11L581.554 478.11L562.564 506.649L535.17 506.649L535.17 497.55L516.18 478.524L516.18 469.752L514.756 469.691L514.756 479.118L533.746 498.145L533.746 508.076L563.323 508.076L582.314 479.537L762.047 479.537L771.542 489.05L858 489.05L858 255.851L677.326 255.851L506.058 256.436Z" fill="#515151"/>
                    </g>
                    </g>
                    <g id="Group 265">
                    <g id="Group 263">
                    <g id="enemy-hud">
                    <path id="Vector_18" d="M653.086 29.9716H586.141L567.123 1.43175H529.466V0H567.884L586.902 28.5398H653.086V29.9716Z" fill="#515151"/>
                    <path id="Vector_19" d="M510.448 23.9021H462.902V25.0913H510.448V23.9021Z" fill="#515151"/>
                    <path id="Vector_20" d="M769.574 34.01L776.706 26.875H779.083L771.951 34.01H769.574Z" fill="#FBC115"/>
                    <path id="Vector_21" d="M774.329 34.01L781.461 26.875H783.838L776.706 34.01H774.329Z" fill="#FBC115" fill-opacity="0.8"/>
                    <path id="Vector_22" d="M779.083 34.01L786.215 26.875H788.592L781.461 34.01H779.083Z" fill="#FBC115" fill-opacity="0.6"/>
                    <path id="Vector_23" d="M783.838 34.01L790.97 26.875H793.347L786.215 34.01H783.838Z" fill="#FBC115" fill-opacity="0.4"/>
                    <path id="Vector_24" d="M788.593 34.01L795.724 26.875H798.102L790.97 34.01H788.593Z" fill="#FBC115" fill-opacity="0.1"/>
                    <path id="Vector_25" d="M579.523 55.6144L579.257 55.2148L600.714 40.9116H653.086V41.3825H600.857L579.523 55.6144Z" fill="#515151"/>
                    <path id="Vector_26" d="M505.536 256.398L856.583 255.556V25.2099H772.009L762.499 34.7232H581.144L562.126 6.18334H534.692V15.2827L515.673 34.3093V43.0806L514.247 43.1424V33.7147L533.265 14.6882V4.75635H562.886L581.905 33.2962H761.905L771.414 23.7829H858V256.983H677.058L505.536 256.398Z" fill="#515151"/>
                    <path id="Vector_27" d="M273.098 29.9716H206.153V28.5398H272.337L291.356 0H329.773V1.43175H292.116L273.098 29.9716Z" fill="#515151"/>
                    <path id="Vector_28" d="M396.337 23.9021H348.792V25.0913H396.337V23.9021Z" fill="#515151"/>
                    <path id="Vector_29" d="M89.6652 34.01L82.5333 26.875H80.156L87.2879 34.01H89.6652Z" fill="#FBC115"/>
                    <path id="Vector_30" d="M84.9106 34.01L77.7787 26.875H75.4014L82.5333 34.01H84.9106Z" fill="#FBC115" fill-opacity="0.8"/>
                    <path id="Vector_31" d="M80.1559 34.01L73.024 26.875H70.6467L77.7786 34.01H80.1559Z" fill="#FBC115" fill-opacity="0.6"/>
                    <path id="Vector_32" d="M75.4013 34.01L68.2694 26.875H65.8921L73.024 34.01H75.4013Z" fill="#FBC115" fill-opacity="0.4"/>
                    <path id="Vector_33" d="M70.6467 34.01L63.5148 26.875H61.1375L68.2694 34.01H70.6467Z" fill="#FBC115" fill-opacity="0.1"/>
                    <path id="Vector_34" d="M352.934 256.356L2.40628 255.513V25.1688H86.8559L96.351 34.682H277.438L296.428 6.14232H323.821V15.2417L342.812 34.2681V43.0394L344.236 43.1012V33.6736L325.246 14.6471V4.71533H295.668L276.678 33.255H96.9445L87.4493 23.7418H0.99173V256.94H181.666L352.934 256.356Z" fill="#515151"/>
                    </g>
                    </g>
                    </g>
                    </g>
                    <g :class="{notColored: !isMyTurn}" id="my-frame-active">
                    <path id="Vector_35" d="M334.881 507.322L339.635 507.322L339.635 497.808L334.881 497.808L334.881 507.322Z" fill="#0050DB"/>
                    <path id="Vector_36" d="M344.39 507.322L349.144 507.322L349.144 497.808L344.39 497.808L344.39 507.322Z" fill="#0050DB"/>
                    <path id="Vector_37" d="M353.899 507.322L358.654 507.322L358.654 497.808L353.899 497.808L353.899 507.322Z" fill="#0050DB"/>
                    <path id="Vector_38" d="M363.408 507.322L368.163 507.322L368.163 497.808L363.408 497.808L363.408 507.322Z" fill="#0050DB"/>
                    <path id="Vector_39" d="M372.917 507.322L377.672 507.322L377.672 497.808L372.917 497.808L372.917 507.322Z" fill="#0050DB"/>
                    <path id="Vector_40" d="M386.221 473.435L392.307 473.435L397.656 484.138L391.57 484.138L386.221 473.435ZM391.57 474.624L388.146 474.624L392.307 482.949L395.73 482.949L391.57 474.624Z" fill="#0050DB"/>
                    <path id="Vector_41" d="M376.712 473.435L382.798 473.435L388.146 484.138L382.061 484.138L376.712 473.435ZM382.061 474.624L378.637 474.624L382.798 482.949L386.221 482.949L382.061 474.624Z" fill="#0050DB" fill-opacity="0.7"/>
                    <path id="Vector_42" d="M367.202 473.435L373.288 473.435L378.637 484.138L372.551 484.138L367.202 473.435ZM372.551 474.624L369.128 474.624L373.288 482.949L376.712 482.949L372.551 474.624Z" fill="#0050DB" fill-opacity="0.4"/>
                    <path id="Vector_43" d="M357.693 473.435L363.779 473.435L369.128 484.138L363.042 484.138L357.693 473.435ZM363.042 474.624L359.619 474.624L363.779 482.949L367.202 482.949L363.042 474.624Z" fill="#0050DB" fill-opacity="0.1"/>
                    <path id="Vector_44" d="M346.767 478.782L349.144 478.782L349.144 469.268L346.767 469.268L346.767 478.782Z" fill="#0050DB"/>
                    <path id="Vector_45" d="M325.148 510.537L328.086 508.896L328.733 506.608L324.806 503.026L316.328 506.779L316 507.945L325.148 510.537Z" fill="#0050DB"/>
                    <path id="Vector_46" d="M520.31 507.322L525.065 507.322L525.065 497.808L520.31 497.808L520.31 507.322Z" fill="#0050DB"/>
                    <path id="Vector_47" d="M510.801 507.322L515.555 507.322L515.555 497.808L510.801 497.808L510.801 507.322Z" fill="#0050DB"/>
                    <path id="Vector_48" d="M501.292 507.322L506.046 507.322L506.046 497.808L501.292 497.808L501.292 507.322Z" fill="#0050DB"/>
                    <path id="Vector_49" d="M491.782 507.322L496.537 507.322L496.537 497.808L491.782 497.808L491.782 507.322Z" fill="#0050DB"/>
                    <path id="Vector_50" d="M482.273 507.322L487.028 507.322L487.028 497.808L482.273 497.808L482.273 507.322Z" fill="#0050DB"/>
                    <path id="Vector_51" d="M368.163 492.457L396.99 492.457L397.166 492.69L411.254 511.484L448.696 511.484L462.96 492.457L491.782 492.457L491.782 493.646L463.554 493.646L449.291 512.673L410.659 512.673L410.479 512.435L396.395 493.646L368.163 493.646L368.163 492.457Z" fill="#0050DB"/>
                    <path id="Vector_52" d="M467.643 473.435L473.729 473.435L468.38 484.138L462.295 484.138L467.643 473.435ZM471.804 474.624L468.38 474.624L464.22 482.949L467.643 482.949L471.804 474.624Z" fill="#0050DB"/>
                    <path id="Vector_53" d="M477.153 473.435L483.239 473.435L477.89 484.138L471.804 484.138L477.153 473.435ZM481.313 474.624L477.89 474.624L473.729 482.949L477.153 482.949L481.313 474.624Z" fill="#0050DB" fill-opacity="0.7"/>
                    <path id="Vector_54" d="M486.662 473.435L492.748 473.435L487.399 484.138L481.313 484.138L486.662 473.435ZM490.822 474.624L487.399 474.624L483.239 482.949L486.662 482.949L490.822 474.624Z" fill="#0050DB" fill-opacity="0.4"/>
                    <path id="Vector_55" d="M496.171 473.435L502.257 473.435L496.908 484.138L490.822 484.138L496.171 473.435ZM500.331 474.624L496.908 474.624L492.748 482.949L496.171 482.949L500.331 474.624Z" fill="#0050DB" fill-opacity="0.1"/>
                    <path id="Vector_56" d="M513.178 469.268L510.801 469.268L510.801 478.782L513.178 478.782L513.178 469.268Z" fill="#0050DB"/>
                    <path id="Vector_57" d="M534.797 510.537L531.859 508.896L531.213 506.608L535.14 503.026L543.617 506.779L543.945 507.945L534.797 510.537Z" fill="#0050DB"/>
                    </g>
                    <g :class="{notColored: isMyTurn}" id="enemy-frame-active">
                    <path id="Vector_58" d="M524.712 5.47021H519.957V14.9835H524.712V5.47021Z" fill="#DB0000"/>
                    <path id="Vector_59" d="M515.202 5.47021H510.448V14.9835H515.202V5.47021Z" fill="#DB0000"/>
                    <path id="Vector_60" d="M505.693 5.47021H500.939V14.9835H505.693V5.47021Z" fill="#DB0000"/>
                    <path id="Vector_61" d="M496.184 5.47021H491.429V14.9835H496.184V5.47021Z" fill="#DB0000"/>
                    <path id="Vector_62" d="M486.675 5.47021H481.92V14.9835H486.675V5.47021Z" fill="#DB0000"/>
                    <path id="Vector_63" d="M512.825 34.01H510.448V43.5233H512.825V34.01Z" fill="#DB0000"/>
                    <path id="Vector_64" d="M534.444 2.25464L531.506 3.89568L530.859 6.18362L534.787 9.76537L543.264 6.01238L543.592 4.84701L534.444 2.25464Z" fill="#DB0000"/>
                    <path id="Vector_65" d="M339.282 5.47021H334.528V14.9835H339.282V5.47021Z" fill="#DB0000"/>
                    <path id="Vector_66" d="M348.791 5.47021H344.037V14.9835H348.791V5.47021Z" fill="#DB0000"/>
                    <path id="Vector_67" d="M358.301 5.47021H353.546V14.9835H358.301V5.47021Z" fill="#DB0000"/>
                    <path id="Vector_68" d="M367.81 5.47021H363.055V14.9835H367.81V5.47021Z" fill="#DB0000"/>
                    <path id="Vector_69" d="M377.319 5.47021H372.564V14.9835H377.319V5.47021Z" fill="#DB0000"/>
                    <path id="Vector_70" d="M491.429 20.3346H462.602L462.426 20.1015L448.338 1.30806H410.896L396.632 20.3346H367.81V19.1454H396.038L410.302 0.118896H448.933L449.113 0.356728L463.197 19.1454H491.429V20.3346Z" fill="#DB0000"/>
                    <path id="Vector_71" d="M346.414 43.5232H348.792V34.0099H346.414V43.5232Z" fill="#DB0000"/>
                    <path id="Vector_72" d="M324.795 2.25464L327.733 3.89568L328.38 6.18362L324.452 9.76537L315.975 6.01238L315.647 4.84701L324.795 2.25464Z" fill="#DB0000"/>
                    <path id="Vector_73" d="M473.372 39.3562H467.286L461.937 28.6538H468.023L473.372 39.3562ZM468.023 38.1671H471.446L467.286 29.843H463.862L468.023 38.1671Z" fill="#DB0000"/>
                    <path id="Vector_74" d="M482.881 39.3562H476.795L471.446 28.6538H477.532L482.881 39.3562ZM477.532 38.1671H480.955L476.795 29.843H473.371L477.532 38.1671Z" fill="#DB0000" fill-opacity="0.7"/>
                    <path id="Vector_75" d="M492.39 39.3562H486.304L480.955 28.6538H487.041L492.39 39.3562ZM487.041 38.1671H490.464L486.304 29.843H482.881L487.041 38.1671Z" fill="#DB0000" fill-opacity="0.4"/>
                    <path id="Vector_76" d="M501.899 39.3562H495.813L490.464 28.6538H496.55L501.899 39.3562ZM496.55 38.1671H499.974L495.813 29.843H492.39L496.55 38.1671Z" fill="#DB0000" fill-opacity="0.1"/>
                    <path id="Vector_77" d="M391.949 39.3562H385.863L391.212 28.6538H397.298L391.949 39.3562ZM387.788 38.1671H391.212L395.372 29.843H391.949L387.788 38.1671Z" fill="#DB0000"/>
                    <path id="Vector_78" d="M382.44 39.3562H376.354L381.703 28.6538H387.789L382.44 39.3562ZM378.279 38.1671H381.703L385.863 29.843H382.44L378.279 38.1671Z" fill="#DB0000" fill-opacity="0.7"/>
                    <path id="Vector_79" d="M372.93 39.3562H366.844L372.193 28.6538H378.279L372.93 39.3562ZM368.77 38.1671H372.193L376.354 29.843H372.93L368.77 38.1671Z" fill="#DB0000" fill-opacity="0.4"/>
                    <path id="Vector_80" d="M363.421 39.3562H357.335L362.684 28.6538H368.77L363.421 39.3562ZM359.261 38.1671H362.684L366.845 29.843H363.421L359.261 38.1671Z" fill="#DB0000" fill-opacity="0.1"/>
                    </g>
                    <path v-if="!isMyTurn" id="my-countdown-holder" d="M427.437 490.009V492.768H420.54V490.009H427.437ZM437.301 490.009V492.768H430.404V490.009H437.301Z" fill="#515151"/>
                    <foreignObject v-if="isMyTurn" class="my-countdown" :x="countdown > 9? 413: 420" :y="insertionsAllowed === 0 ? 455 : 470" width="150" height="200">{{ countdown }}</foreignObject>
                    <foreignObject @click="endTurn()" v-if="isMyTurn && insertionsAllowed === 0" class="my-countdown blinking-element" :x="413"  y="485" width="150" height="200" style="font-size: 16px; cursor: pointer">SKIP</foreignObject>
                    <g v-if="!isMyTurn" id="enemy-picking">
                    <g id="Group 276">
                    <g id="Group 93">
                    <path id="Vector_81" d="M487.961 265.018L487.961 263.995L495.934 263.995L504.12 255.809L668.047 255.809L668.047 256.832L504.545 256.832L496.36 265.018L487.961 265.018Z" fill="#515151"/>
                    <path id="Vector_82" d="M190.647 256.832L190.647 255.809L354.574 255.809L362.76 263.994L370.732 263.994L370.732 265.018L362.334 265.018L354.148 256.832L190.647 256.832Z" fill="#515151"/>
                    </g>
                    <g id="Group 271">
                    <g id="Group 270">
                    <path id="Vector_83" d="M480.158 255.035C479.063 244.313 474.727 234.179 467.728 225.983L468.734 225.121C475.907 233.522 480.352 243.909 481.476 254.899L480.158 255.035Z" fill="#DB0000"/>
                    <path id="Vector_84" d="M470.989 229.852C470.106 229.698 469.211 229.577 468.344 229.462C466.557 227.095 464.57 224.886 462.405 222.859C463.373 222.787 464.291 222.808 465.286 222.793C467.313 224.83 469.167 227.032 470.83 229.376C470.892 229.535 470.949 229.69 470.989 229.852Z" fill="#DB0000"/>
                    <path id="Vector_85" d="M458.13 218.542L457.068 217.758L459.379 214.444L460.524 215.286L458.13 218.542Z" fill="#DB0000"/>
                    <path id="Vector_86" d="M424.927 207.257C414.162 207.8 403.816 211.603 395.263 218.162L394.455 217.11C403.221 210.387 413.826 206.49 424.86 205.936L424.927 207.257Z" fill="#DB0000"/>
                    <path id="Vector_87" d="M374.326 255.594L373.995 255.567C374.53 249.017 376.279 242.624 379.153 236.714C382.027 230.807 385.943 225.468 390.714 220.952L390.941 221.191C386.2 225.681 382.308 230.988 379.449 236.858C376.595 242.732 374.857 249.085 374.326 255.594Z" fill="#DB0000"/>
                    <path id="Vector_88" d="M374.234 254.726C374.502 254.752 374.749 254.882 374.921 255.088C375.094 255.294 375.179 255.56 375.158 255.828C375.132 256.096 375.004 256.344 374.8 256.519C374.596 256.694 374.331 256.784 374.063 256.769C373.928 256.76 373.797 256.725 373.677 256.664C373.557 256.603 373.45 256.519 373.363 256.416C373.277 256.313 373.212 256.193 373.173 256.064C373.134 255.935 373.121 255.8 373.136 255.666C373.144 255.532 373.18 255.4 373.24 255.28C373.3 255.159 373.384 255.052 373.486 254.964C373.589 254.876 373.708 254.81 373.836 254.769C373.965 254.728 374.1 254.714 374.234 254.726Z" fill="#DB0000"/>
                    <path id="Vector_89" d="M391.588 220.385C391.678 220.483 391.747 220.597 391.792 220.722C391.837 220.846 391.856 220.979 391.85 221.111C391.844 221.243 391.812 221.373 391.755 221.493C391.699 221.613 391.62 221.72 391.522 221.81C391.425 221.901 391.31 221.972 391.186 222.02C391.061 222.067 390.929 222.089 390.795 222.085C390.662 222.081 390.531 222.051 390.41 221.996C390.288 221.942 390.179 221.864 390.087 221.767C389.996 221.67 389.924 221.556 389.877 221.431C389.83 221.306 389.808 221.174 389.812 221.041C389.816 220.907 389.846 220.776 389.9 220.655C389.955 220.533 390.033 220.424 390.13 220.332C390.229 220.24 390.345 220.168 390.472 220.12C390.599 220.073 390.735 220.051 390.87 220.056C391.006 220.061 391.139 220.092 391.262 220.149C391.385 220.205 391.496 220.285 391.588 220.385Z" fill="#DB0000"/>
                    <path id="Vector_90" d="M394.455 217.107C394.547 216.446 394.658 215.781 394.789 215.112C399.383 211.767 404.463 209.145 409.851 207.337C410.595 207.685 411.316 208.061 412.041 208.434L411.382 208.671L410.621 208.941L409.645 209.335C408.935 209.627 408.097 209.952 407.231 210.373L405.891 210.998L404.54 211.709C402.869 212.585 401.246 213.549 399.677 214.596C399.016 215.002 398.502 215.406 398.119 215.666C397.735 215.926 397.509 216.089 397.479 216.097L396.906 216.258L395.893 216.606L394.455 217.107Z" fill="#DB0000"/>
                    <path id="Vector_91" d="M424.86 205.933L424.93 205.993L425.766 206.736L426.596 207.524C429.296 207.463 431.997 207.62 434.672 207.993L435.109 208.545C435.321 208.819 435.518 209.091 435.479 209.085L433.728 208.842C433.208 208.769 432.603 208.735 431.954 208.67L430.958 208.582C430.617 208.556 430.27 208.552 429.925 208.535C428.543 208.456 427.161 208.486 426.126 208.495C425.608 208.502 425.18 208.545 424.865 208.555L424.392 208.583C423.86 208.102 423.316 207.607 422.758 207.16L424.86 205.933Z" fill="#DB0000"/>
                    <path id="Vector_92" d="M443.135 210.88L441.871 210.513L442.993 206.633L444.357 207.029L443.135 210.88Z" fill="#DB0000"/>
                    <path id="Vector_93" d="M450.361 213.794L449.167 213.24L450.863 209.575C451.293 209.772 451.726 209.967 452.151 210.173L450.361 213.794Z" fill="#DB0000"/>
                    <path id="Vector_94" d="M457.068 217.759L455.969 217.033L458.195 213.663L459.379 214.445L457.068 217.759Z" fill="#DB0000"/>
                    </g>
                    <path id="Vector_95" d="M428.501 223.051L428.455 223L428.455 223.102L421 231.542L421 236L428.501 227.509L436 236L436 231.542L428.545 223.102L428.545 223L428.501 223.051Z" fill="#DB0000"/>
                    </g>
                    </g>
                    </g>
                    <g v-if="isMyTurn" id="me-picking">
                    <g id="Group 274">
                    <g id="Group 271_2">
                    <g id="Group 270_2">
                    <path id="Vector_96" d="M480.158 258.191C479.063 268.913 474.727 279.047 467.728 287.243L468.734 288.105C475.908 279.704 480.352 269.317 481.476 258.327L480.158 258.191Z" fill="#0050DB"/>
                    <path id="Vector_97" d="M470.989 283.374C470.106 283.529 469.212 283.65 468.344 283.764C466.558 286.131 464.571 288.34 462.405 290.367C463.374 290.439 464.291 290.418 465.286 290.433C467.313 288.396 469.167 286.194 470.83 283.851C470.893 283.692 470.949 283.537 470.989 283.374Z" fill="#0050DB"/>
                    <path id="Vector_98" d="M458.13 294.685L457.068 295.468L459.38 298.782L460.524 297.94L458.13 294.685Z" fill="#0050DB"/>
                    <path id="Vector_99" d="M424.927 305.969C414.162 305.426 403.817 301.623 395.264 295.064L394.455 296.116C403.222 302.839 413.826 306.736 424.86 307.29L424.927 305.969Z" fill="#0050DB"/>
                    <path id="Vector_100" d="M374.326 257.632L373.995 257.66C374.53 264.21 376.279 270.603 379.153 276.513C382.027 282.419 385.944 287.759 390.714 292.274L390.941 292.036C386.2 287.546 382.308 282.238 379.45 276.368C376.595 270.495 374.858 264.141 374.326 257.632Z" fill="#0050DB"/>
                    <path id="Vector_101" d="M374.234 258.5C374.502 258.474 374.749 258.344 374.922 258.138C375.094 257.932 375.179 257.666 375.158 257.398C375.132 257.13 375.004 256.883 374.8 256.707C374.596 256.532 374.332 256.443 374.063 256.457C373.929 256.466 373.797 256.502 373.677 256.562C373.557 256.623 373.45 256.707 373.364 256.81C373.277 256.914 373.212 257.033 373.173 257.162C373.134 257.291 373.121 257.426 373.136 257.56C373.145 257.695 373.18 257.826 373.24 257.947C373.3 258.067 373.384 258.175 373.487 258.262C373.589 258.35 373.708 258.416 373.836 258.457C373.965 258.498 374.1 258.513 374.234 258.5Z" fill="#0050DB"/>
                    <path id="Vector_102" d="M391.589 292.842C391.678 292.744 391.747 292.629 391.792 292.505C391.837 292.38 391.857 292.248 391.851 292.115C391.844 291.983 391.812 291.853 391.756 291.733C391.699 291.613 391.62 291.506 391.522 291.417C391.425 291.325 391.311 291.254 391.186 291.207C391.062 291.159 390.929 291.137 390.796 291.141C390.663 291.145 390.531 291.175 390.41 291.23C390.288 291.285 390.179 291.363 390.087 291.46C389.996 291.557 389.925 291.671 389.877 291.795C389.83 291.92 389.808 292.053 389.812 292.186C389.816 292.319 389.846 292.45 389.901 292.572C389.955 292.693 390.033 292.803 390.13 292.894C390.229 292.987 390.346 293.059 390.473 293.106C390.6 293.154 390.735 293.176 390.87 293.171C391.006 293.166 391.139 293.134 391.262 293.078C391.386 293.021 391.496 292.941 391.589 292.842Z" fill="#0050DB"/>
                    <path id="Vector_103" d="M394.455 296.119C394.547 296.78 394.659 297.445 394.789 298.114C399.383 301.46 404.463 304.082 409.851 305.889C410.595 305.541 411.316 305.166 412.041 304.792L411.382 304.555L410.621 304.285L409.646 303.892C408.935 303.599 408.098 303.274 407.231 302.853L405.892 302.228L404.54 301.517C402.869 300.641 401.246 299.678 399.677 298.63C399.016 298.224 398.503 297.82 398.119 297.56C397.735 297.3 397.509 297.138 397.48 297.129L396.906 296.968L395.893 296.62L394.455 296.119Z" fill="#0050DB"/>
                    <path id="Vector_104" d="M424.861 307.293L424.931 307.233L425.767 306.491L426.596 305.702C429.297 305.764 431.997 305.607 434.673 305.233L435.109 304.681C435.322 304.407 435.519 304.136 435.479 304.141L433.728 304.385C433.209 304.457 432.603 304.491 431.954 304.556L430.958 304.645C430.617 304.67 430.271 304.674 429.925 304.691C428.543 304.771 427.161 304.741 426.126 304.731C425.609 304.725 425.18 304.681 424.865 304.672L424.392 304.643C423.861 305.124 423.316 305.62 422.758 306.067L424.861 307.293Z" fill="#0050DB"/>
                    <path id="Vector_105" d="M443.136 302.347L441.871 302.713L442.993 306.594L444.357 306.197L443.136 302.347Z" fill="#0050DB"/>
                    <path id="Vector_106" d="M450.361 299.432L449.167 299.986L450.863 303.652C451.293 303.454 451.726 303.259 452.152 303.053L450.361 299.432Z" fill="#0050DB"/>
                    <path id="Vector_107" d="M457.068 295.468L455.97 296.194L458.195 299.563L459.38 298.782L457.068 295.468Z" fill="#0050DB"/>
                    </g>
                    <path id="Vector_108" d="M428.501 290.175L428.455 290.226L428.455 290.125L421 281.685L421 277.226L428.501 285.717L436 277.226L436 281.685L428.545 290.125L428.545 290.226L428.501 290.175Z" fill="#0050DB"/>
                    </g>
                    <g id="Group 93_2">
                    <path id="Vector_109" d="M487.961 248L487.961 249.023L495.934 249.023L504.12 257.209L668 257L668 255.977L504.546 256.186L496.36 248L487.961 248Z" fill="#515151"/>
                    <path id="Vector_110" d="M190.647 255.793L190.647 256.894L354.574 257.209L362.76 249.023L370.733 249.023L370.733 248L362.334 248L354.148 256.186L190.647 255.793Z" fill="#515151"/>
                    </g>
                    </g>
                    </g>
                    <path v-if="isMyTurn" id="enemy-countdown-holder" d="M427.438 20.9912V23.75H420.541V20.9912H427.438ZM437.301 20.9912V23.75H430.404V20.9912H437.301Z" fill="#515151"/>
                    <foreignObject v-if="!isMyTurn" class="enemy-countdown" :x="countdown > 9? 413: 420" y="4" width="150" height="200">{{ countdown }}</foreignObject>
                    <path id="picking" :fill="isMyTurn ? '#0050DB' : '#DB0000'" d="M404.686 247.124L404.322 258.604L403.034 259.164L402.278 259.5L400.626 260.228V260.2L398.666 261.012H396.594L396.398 265.828H392.842L393.542 247.124H395.446H397.182H401.046H403.286H404.686ZM398.666 257.26L400.738 256.364L400.906 250.708H397.042L396.762 257.26H398.666ZM409.14 265.856H405.5L406.144 247.096H409.784L409.14 265.856ZM414.062 265.856H410.45L411.066 247.124H414.706L414.062 265.856ZM411.878 265.856L410.506 264.12L419.606 260.2V263.98L415.266 265.856H411.878ZM412.662 250.736V247.124H420.502L420.138 250.736H412.662ZM424.584 265.856H420.944L421.588 247.124H425.228L424.584 265.856ZM422.848 261.18L422.26 256.476L429.484 247.152H434.468L422.848 261.18ZM424.836 252.864L433.236 265.856H429.204L423.492 257.148L424.836 252.864ZM438.343 265.856H434.703L435.347 247.096H438.987L438.343 265.856ZM443.265 265.856H439.625L440.297 247.124H443.937L443.265 265.856ZM451.833 265.856H448.193L448.865 247.124H452.505L451.833 265.856ZM452.309 253.088L451.609 254.236L443.601 250.764L443.937 247.124L452.085 250.652L452.309 253.088ZM464.13 263.196L460.49 264.736L460.686 255.272H464.326L464.13 263.196ZM456.766 265.856H453.154L453.798 247.124H457.438L456.766 265.856ZM454.582 265.856L453.21 264.12L461.694 260.424V264.232L457.97 265.856H454.582ZM455.646 250.736V247.124H464.466L464.326 250.736H455.646Z"/>
                    </g>
                </svg>
            </template> 
            <div class="enemy-hex-row">
                <div class="hex-el" v-for="(hex, index) in enemyPicks" :key="index">
                    <img class="hex-bg" src="/hex.svg">
                    <img class="spaceship" :src="spaceshipImg(hex)">
                </div>
            </div>
            <div class="my-hex-row">
                <div @mouseenter="hoverHex(hex, index)" @mouseleave="hovered = undefined" @click="selectHexPosition(hex, index)" :class="{'hex-el': true, 'hex-selectable': hovered === index}" v-for="(hex, index) in myPicks" :key="index">
                    <img :class="renderHexImg(hex, index)" :src="hexImg(hex, index)">
                    <img class="spaceship" :src="spaceshipImg(hex)">
                </div>
            </div>
        </div>
        <div :class="{'picker-carousel': true, 'disabled': !isMyTurn || insertionsAllowed === 0}">
            <b-carousel-list v-model="test" :data="spaceshipsRotation" :items-to-show="8" :arrow-hover="false" :indicator-inside="false" :has-drag="false">
                    <template #item="spaceshipObj">
                        <div 
                        :class="{'card picker-card': true, 'selected-card': selected !== undefined && selected.type === spaceshipObj.type, 'unselected-card': selected !== undefined && selected.type !== spaceshipObj.type}"
                        >
                            <div class="card-image">
                                <figure class="image">
                                    <a @click="selectSpaceship(spaceshipObj)">
                                        <img class="spaceship-picker-img" :src="spaceshipObj.image">
                                    </a>
                                </figure>
                            </div>
                        </div>
                    </template>
            </b-carousel-list>
        </div>
    </div>
</template>


<script>
import CONSTANTS from "../../constants.json"
import axios from 'axios'

export default {
    props:['state','playerIs', 'playerTurn', 'lastTurnTimestamp'],
    data() {
        return {
            date: Date.now(),
            dateInterval: undefined,
            turnTimeout: CONSTANTS.pickingTurnTimeout,
            test: 0,
            spaceships: [...CONSTANTS.freeSpaceshipsRotation],
            myPicks: [{},{},{},{},{},{},{},{},{},],
            enemyPicks: [{},{},{},{},{},{},{},{},{},],
            turnSfx: require('../assets/sfx/turn.mp3'),
            selected: undefined,
            insertionsAllowed: 3,
            hovered: undefined
        }
    },
    computed: {
        spaceshipsRotation() {
            let spaceships = [...this.spaceships]
            return spaceships.map((spaceship) => {
                return {
                    type: spaceship,
                    image: require(`../assets/blue/${spaceship}.png`),
                    info: CONSTANTS.spaceshipsAttributes[spaceship]
                }
            })
        },
        isMyTurn() {
            return this.playerTurn === this.playerIs
        },
        countdown() {
            if (this.lastTurnTimestamp === undefined) return this.turnTimeout
            return Math.max(Math.floor((this.lastTurnTimestamp + (this.turnTimeout * 1000) - this.date) / 1000), 0)
        },
        // allowedInsertions() {
        //     if(this.selected !== undefined) {
        //         if()
        //     }
        // },
    },
    methods: {
        playSound(sfx) {
			var audio = new Audio(sfx)
			try {
				audio.play()
			} catch(e) { console.log(e) }
		},
        spaceshipImg(hex) {
            if(hex.type === undefined) return require('../assets/img/blank.gif')
            else return require(`../assets/blue/${hex.type}.png`)
        },
        hexImg(hex, index) {
            if(this.isMyTurn) {
                if(hex.type === undefined && this.selected === undefined) return '/hex-slot.svg'
                else if(hex.type === undefined && this.selected !== undefined) return '/insertion-slot.svg'
                else if(hex.type !== undefined && this.hovered === index) return '/removable-slot.svg'
                else return '/occupied-slot.svg'
            } else return '/hex.svg'
        },
        renderHexImg(hex, index) {
            let classes = 'hex-bg '
            if(this.hovered === index) classes += 'hex-selectable '
            if(this.selected !== undefined) {
                if(hex.length > 0) classes += 'occupied '
                else classes += 'allowed-position '
            }
            return classes
        },
        endTurn() {
			this.playSound(this.turnSfx) 
            this.$store.commit('endTurn')
			this.$store.dispatch('enqueue', () => axios.get('/api/match/endTurn', {
				params:{
					signature:this.$store.state.signature,
					matchId: this.$store.state.matchId
				}
			}))
    	},
        endEnemyTurn() {
            this.$store.commit('endTurn')
			this.$store.dispatch('enqueue', axios.get('/api/match/endEnemyTurn', {
				params:{
					signature:this.$store.state.signature,
					matchId: this.$store.state.matchId
				}
			}))
    	},
        spaceshipAddedSnackbar(type) {
            this.$buefy.snackbar.open({
                duration: 2000,
                message: `${type} was added to your fleet.`
                ,
                type: 'is-success',
                position: 'is-top',
                queue: true
            })
        },
        spaceshipRemovedSnackbar(type) {
            this.$buefy.snackbar.open({
                duration: 2000,
                message: `${type} was removed to your fleet.`
                ,
                type: 'is-success',
                position: 'is-top',
                queue: true
            })
        },
        spaceshipMaxReachedSnackbar() {
            this.$buefy.snackbar.open({
                duration: 3000,
                message: 'Cannot add more than two spaceships of the same type to your fleet.',
                type: 'is-danger',
                position: 'is-top',
                queue: true
            })
        },
        capitalize(str) {
			if(str) {
				const lower = str.toLowerCase()
				return str.charAt(0).toUpperCase() + lower.slice(1)
			}
			return str
		},
        selectSpaceship(spaceshipObj) {
            if(this.selected === undefined) this.selected = spaceshipObj
            else if(this.selected !== undefined && this.selected.type !== spaceshipObj.type) this.selected = spaceshipObj
            else this.selected = undefined
        },
        insertSpaceship(spaceship, hexId) {
            if(this.isMyTurn && this.insertionsAllowed > 0) {
                let sameInserted = 0
                this.myPicks.forEach((element) => {
                    if(element.type === spaceship.type) sameInserted++
                });
                if(sameInserted < 2 && this.insertionsAllowed > 0) {
                    this.myPicks[hexId] = { type: spaceship.type, owner: this.playerIs }
                    this.insertionsAllowed--
                    sameInserted++
                    if(sameInserted === 2) {
                        this.spaceships = this.spaceships.filter(spaceshipType => spaceshipType !== spaceship.type)
                    }
                    this.spaceshipAddedSnackbar(this.capitalize(spaceship.type))
                } else {
                    this.spaceshipMaxReachedSnackbar(this.capitalize(spaceship.type))
                }
            }
        },
        removeSpaceship(hexId) {
            let spaceshipType = this.myPicks[hexId].type
            if(!this.spaceships.includes(spaceshipType)) {
                this.spaceships.unshift(spaceshipType)
            } 
            this.myPicks[hexId] = {}
            this.insertionsAllowed++
        },
        spaceshipInsertedTwice(type) {
            let sameInserted = 0
            this.myPicks.forEach((element) => {
                if(element.type === type) sameInserted++
            });
            return sameInserted === 2
        },
        selectHexPosition(hex, index) {
            if(this.selected !== undefined) {
                this.insertSpaceship(this.selected, index)
                this.selected = undefined
            } else if(hex.type !== undefined) {
                this.removeSpaceship(index)
            }
        },
        hoverHex(hex, index) {
            this.hovered = index
        }
    },
    watch: {
        countdown(newCountdown) {
            if(newCountdown === 0 && this.isEnemyTurn) {
                setTimeout(() => {
                    if(this.countdown === 0 && this.isEnemyTurn) this.endEnemyTurn()
                }, 5000)
            }
            if(newCountdown === 0 && this.isMyTurn) {
                this.endTurn()
            }
        },
        playerTurn() {
            this.insertionsAllowed = 3
        }
    },
    created() {
        if(this.countdown === 0 && this.isMyTurn) this.endTurn()
        const self = this
        this.dateInterval = setInterval(function () {
            self.date = Date.now()
        }, 1000)

        if(this.countdown === 0  && this.isEnemyTurn) {
            this.endEnemyTurn()
        }
    },
    beforeDestroy () {
        clearInterval(this.dateInterval)
    }
}
</script>

<style scoped>
.picking-bg {
    height: 100%;
    padding-top: 40px;
    background-image: url('/picking-bg.png');
    background-repeat: no-repeat;
    background-position: top;
}
.my-picks-box {
    background-image: url('/blue-box.svg');
    background-repeat: no-repeat;
    background-position: center;
    height: 134px;
}
.spaceship {
    position: absolute;
    height: 85px;
    left: 13px;
    top: 20px;
}
.my-hex-row {
    margin-top: 310px;
    margin-left: 52px;
    z-index: 2;
}
.enemy-hex-row {
    margin-top: -550px;
    margin-left: 52px;
    z-index: 2;
}
.hex-el {
	display: inline;
    float: left;
    height: 130px;
    margin-right: -2.6px;
    position: relative;
}
.hex-selectable {
    cursor: pointer !important;
}
.hex-bg {
    width: 110px;
	position: relative;
    opacity: 0.7;
}
.picker-carousel {
    margin-top: 600px !important;
    width: 1100px;
    margin: 0 auto;
    z-index: 1;
}
.picker-card {
    background: url('/spaceship-picker-frame.svg');
    background-repeat: no-repeat;
    background-size: 100%;
    /* background-position: 25px 22px; */
    height: 120px;
    margin-right: 30px;
}
.card-image {
    margin-top: 20px;
}
.spaceship-picker-img {
    width: 68px;
    margin: 0 auto;
    padding-top: 18px;
}
.card.picker-card {
  box-shadow: none;
  transition: all 250ms ease-in-out;
}
.card.picker-card:hover {
  margin-top: -15px;
}
.selected-card {
    margin-top: -15px;
}
.unselected-card {
    opacity: 0.4;
}
.carousel-list.has-shadow {
    box-shadow: none;
}
.p-counter {
    padding: 25px 0px 25px 0px;
}
.picking-hud-wrapper {
    width: 1100px;
    height: 100%;
    margin: 0 auto;
}
.allowed-position {
    opacity: 1;
}
/* #enemy-picking * {
    display: none;
}
#me-picking * {
    display: block;
}
#enemy-frame-active * {
    fill: #515151;
} */
.notColored * {
    fill: #515151;
}
.picker-carousel.disabled * {
    cursor: not-allowed;
    opacity: 0.8;
    filter: grayscale(1);
}
.my-countdown {
    /* margin: 0 auto;
    width: fit-content; */
    color: #0050DB;
    font-size: 27px;
    font-weight: 700;
    margin-top: -65px;
}
.enemy-countdown {
    color: #DB0000;
    font-size: 27px;
    font-weight: 700;
    margin-top: -65px;
}
.end-picking-btn {
    color: #0050DB;
    text-transform: uppercase;
    font-size: 18px;
    font-weight: 300;
    margin: 0 auto;
}
.blinking-element:hover {
    animation: none;
}
.blinking-element {
  animation: blink 1s steps(2, start) infinite;
}
@keyframes blink {
  to {
    visibility: hidden;
  }
}
</style>